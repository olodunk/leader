# 数据库结构设计文档

本文档详细描述了系统数据库 (`evaluation.db`) 的表结构设计。系统采用 SQLite 数据库，主要包含基础配置、人员管理、评分记录三大核心模块。

## 1. 系统与基础配置模块

本模块负责系统的基础运行参数、组织架构定义及用户权限管理。

### 1.1 系统用户表 (`sys_users`)
用于管理后台的登录认证。
- **username**: 管理员账号（唯一标识）。
- **password**: 经过加密处理的密码哈希值。
- **role**: 用户角色权限（目前主要为 `admin`）。

### 1.2 部门配置表 (`department_config`)
系统的核心骨架，定义了所有组织机构及其对应的业务规则。
- **基本信息**: 包含部门名称 (`dept_name`)、部门代码 (`dept_code`) 及排序号。
- **领导班子**: 关联部门的主管领导与分管领导信息。
- **账号生成策略**: 定义了该部门需要生成的各类身份（正职/副职/群众等）的测评账号数量。
- **推荐名额限制**: 设定了该部门在“优秀干部推荐”环节中，正职与副职的最大推荐人数。

### 1.3 测评账号表 (`evaluation_accounts`)
存储实际发放给测评人员的登录凭证，“一人一号”。
- **username**: 自动生成的测评账号（如 `A0L001`）。
- **password**: 测评账号密码（通常为明文或简单哈希，视安全需求而定）。
- **dept_code**: 账号所属的部门。
- **account_type**: 账号的身份标签（如“正职”、“副职”）。
- **status**: 锁定状态，用于标记该账号是否已提交测评（`否` 表示已提交）。

### 1.4 部门权重配置表 (`weight_config_dept`)
定义了不同身份人员在进行评价时的权重系数。
- **关系定义**: 记录“考核人角色”对“被考核人角色”的评分权重。
- **weight**: 具体的权重百分比数值。

---

## 2. 人员与候选人模块

本模块维护了各类被测评人员及推荐候选人的基础信息。

### 2.1 中层干部信息表 (`middle_managers`)
全院参与测评的中层干部花名册，是生成测评问卷的基础数据源。
- **核心字段**: 姓名、性别、现任职务、所在部门。
- **分类标记**: 岗位层级、任职时间、是否新提拔干部。

### 2.2 优秀干部推荐库 (`recommend_principal` / `recommend_deputy`)
分为两个独立的表，分别管理**正职**和**副职**的推荐候选人池。
- **用途**: 在“优秀干部民主推荐”页面，系统会根据用户的部门代码，从这两个表中加载对应的同部门候选人供用户勾选。
- **核心字段**: 排序号、姓名、现职务、岗位层级。

---

## 3. 评分与业务数据模块

本模块记录了所有测评业务产生的过程数据和最终结果。

### 3.1 领导班子综合评价表 (`team_scores`)
记录对各部门领导班子整体表现的评分。
- **关联关系**: 记录 `rater_account`（谁评的）与 `target_dept_code`（评的哪个部门）。
- **评价维度**: 包含政治责任、工作实绩、党风廉政等 12 个具体维度的得分。

### 3.2 干部综合评价得分表 (`personnel_scores`)
记录对中层领导干部的个人综合打分。
- **关联关系**: 关联被测评干部的 ID (`examinee_id`)。
- **评价内容**: 包含德、能、勤、绩、廉 5 大维度的定量评分，以及“优秀/称职”等定性评价。

### 3.3 民主测评得分表 (`democratic_scores`)
用于“中层干部民主测评”专项的打分记录。
- **特点**: 针对特定的测评问卷结构，记录详细的指标得分。

### 3.4 推荐结果记录表
分为 **正职推荐表** (`recommendation_scores_principal`) 和 **副职推荐表** (`recommendation_scores_deputy`)。
- **记录逻辑**: 存储用户的投票结果。每一条记录代表一张选票中的一个被推荐人。
- **特殊处理**: 若用户在提交时未选择任何人（放弃推荐），系统会插入一条 `examinee_id=0` 的记录，以确保该用户被统计为“已参与”。

---

## 4. 权限控制模块

### 4.1 民主测评权限表 (`democratic_rating_config`)
通过矩阵方式定义了详尽的打分权限规则。
- **逻辑**: 通过 `rater_role`（谁）和 `examinee_role`（评谁）的组合，字段 `is_allowed` 控制是否允许进行打分。此配置决定了用户登录后能看到哪些被测评对象。
